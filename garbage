   const handleMouseDown = useCallback((e) => {
        if (e.button !== DRAG_BUTTON) return;
        const pt = ScreenToGlobal(e.clientX, e.clientY);
        const obj = getObjectUnderCursor(pt);
        selectedChanged(obj);

        if (obj) {
            if (obj.type === ObjectType.ELEMENT) {
                dragMode.current = DragMode.ELEMENT;
            } else if (obj.type === ObjectType.PIN) {

                const resultInitAStar = initAStar(obj.pinCoords);
                console.log(`resultInitAStar: ${resultInitAStar}`);
                if (resultInitAStar)
                    dragMode.current = DragMode.ROUTING;
                // console.log(`dragMode: ${dragMode.current}`);
            }
            //  else wire....

        } else  // none from above - simple canvas drag
            dragMode.current = DragMode.SCROLL;
        lastPos.current = { x: e.clientX, y: e.clientY };
    }, [ScreenToGlobal, getObjectUnderCursor, selectedChanged, initAStar]);

 const handleMouseMove = (e) => {
        const pt = ScreenToGlobal(e.clientX, e.clientY);

        const obj = getObjectUnderCursor(pt);
        hoveredChanged(obj);


        // JUST FOR DEBUG --------------------
        const canvasRect = canvasRef.current.getBoundingClientRect();
        const mp = { x: e.clientX - canvasRect.left, y: e.clientY - canvasRect.top };
        setMousePos(mp);
        setGlobalPos(pt);
        // DEBUG END -------------------------
        // console.log(`dragMode: ${dragMode.current}`);
        if (dragMode.current) {
            const dx = e.clientX - lastPos.current.x;
            const dy = e.clientY - lastPos.current.y;
            switch (dragMode.current) {
                case DragMode.SCROLL:

                    viewRef.current.x -= dx;
                    viewRef.current.y -= dy;
                    setView({ ...viewRef.current });
                    break;
                case DragMode.ELEMENT: {

                    const newElem = { ...schemaElements.elements[selectedRef.current.elementId] };
                    newElem.pos = addPoint(newElem.pos, [dx / viewRef.current.zoom, dy / viewRef.current.zoom]);
                    onElemChanged(newElem, false);
                } break;
                case DragMode.ROUTING: {
                    routeAStar(pt);

                } break;

            }
            lastPos.current = { x: e.clientX, y: e.clientY };
        }
    };


храним

    "wires": {
    "w_1": {
        "id": "w_1",
        "source": { "type": "PIN", "elementId": 123, "pinIdx": 0 },
        "target": { "type": "TCONN", "pos": [52, 45] }, // Прямо в объекте храним точку стыка
        "path": [[10, 45], [52, 45]] // Кеш пути для отрисовки
    }
}

клик по проводу
{
    type: ObjectType.WIRE,
    wireId: "w_105",     // ID провода из твоего стейта
    pos: [52, 45],       // Точка в попугаях, куда мы "врезаемся"
    // Можно также добавить ссылку на сам объект провода для удобства
}

{type: 'PIN', elementId: 1770957831203, pinIdx: 'PIN1', pinCoords: Array(2)}
{type: 'PIN', elementId: 1770957832868, pinIdx: 'PIN2', pinCoords: Array(2)}
