<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>LS Full Porter</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f0f0f0;
            color: #333;
        }

        textarea {
            width: 100%;
            height: 300px;
            margin-bottom: 10px;
            font-family: monospace;
            display: block;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            cursor: pointer;
            border: 1px solid #999;
            background: #fff;
            font-weight: bold;
        }

        button:hover {
            background: #ddd;
        }

        .status {
            margin-top: 15px;
            font-weight: bold;
            color: #0056b3;
        }

        .danger {
            background: #ffebee;
            border-color: #c62828;
            color: #c62828;
        }
    </style>
</head>

<body>

    <h2>Утилита полного переноса LocalStorage</h2>

    <textarea id="box" placeholder="Здесь будет ваш JSON..."></textarea>

    <div class="controls">
        <button onclick="exportAll()">1. Собрать всё из LS</button>
        <button onclick="copyToClip()">2. Копировать в буфер</button>
        <button onclick="pasteFromClip()">3. Вставить из буфера</button>
        <button onclick="importAll()">4. Накатить всё в LS</button>
        <button class="danger" onclick="clearLS()">Очистить LS</button>
    </div>

    <div id="status" class="status"></div>

    <script>
        const box = document.getElementById('box');
        const status = document.getElementById('status');

        function setStatus(msg) {
            status.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
        }

       function exportAll() {
            const data = {};
            Object.keys(localStorage).forEach(key => {
                let val = localStorage.getItem(key);
                try {
                    // Пытаемся превратить строку обратно в объект
                    val = JSON.parse(val);
                } catch (e) {
                    // Если это обычная строка (не JSON), оставляем как есть
                }
                data[key] = val;
            });
            box.value = JSON.stringify(data);
            setStatus('Все данные собраны (вложенный JSON распакован)');
        }

   function importAll() {
            try {
                const data = JSON.parse(box.value);
                Object.keys(data).forEach(key => {
                    let val = data[key];
                    // LS принимает только строки, поэтому объекты запаковываем обратно
                    if (typeof val === 'object' && val !== null) {
                        val = JSON.stringify(val);
                    }
                    localStorage.setItem(key, val);
                });
                setStatus('Данные успешно развернуты в LocalStorage');
            } catch (err) {
                setStatus('Ошибка: Невалидный JSON!');
            }
        }

        // Копирование
        async function copyToClip() {
            await navigator.clipboard.writeText(box.value);
            setStatus('JSON скопирован в буфер');
        }

        // Вставка
        async function pasteFromClip() {
            try {
                const text = await navigator.clipboard.readText();
                box.value = text;
                setStatus('JSON вставлен из буфера');
            } catch (err) {
                setStatus('Ошибка доступа к буферу');
            }
        }

        // Полная очистка
        function clearLS() {
            if (confirm('Внимание! Это удалит ВСЕ данные из LocalStorage на этом домене. Уверен?')) {
                localStorage.clear();
                box.value = '';
                setStatus('LocalStorage полностью очищен');
            }
        }
    </script>
</body>

</html>